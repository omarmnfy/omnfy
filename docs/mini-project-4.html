<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Omar Mnfy</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Omar Mnfy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./dataviz.html"> 
<span class="menu-text">Data Viz</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./mini-project-2.html"> 
<span class="menu-text">Mini-Project 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./iteration-project-3.html"> 
<span class="menu-text">Iteration Project 3</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./mini-project-4.html" aria-current="page"> 
<span class="menu-text">SQL Project 4</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./presentation.html"> 
<span class="menu-text">Presentation</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="part-1" class="level2">
<h2 class="anchored" data-anchor-id="part-1">Part 1</h2>
<section id="recreate-figure-1-from-voss-2020" class="level3">
<h3 class="anchored" data-anchor-id="recreate-figure-1-from-voss-2020">Recreate Figure 1 from Voss (2020)</h3>
</section>
<section id="step-1-establish-connection-with-the-datasbase-host" class="level3">
<h3 class="anchored" data-anchor-id="step-1-establish-connection-with-the-datasbase-host">Step 1: Establish Connection with the Datasbase Host</h3>
<section id="plan" class="level4">
<h4 class="anchored" data-anchor-id="plan"><strong>Plan</strong>:</h4>
<ol type="1">
<li><ul>
<li><p>Use SQL to query the <code>Measurements</code> table and filter for the 12 studies mentioned in Figure 1. Specifically, extract the <code>Frequency</code> and <code>Absorbance</code> fields.</p></li>
<li><p>Calculate the mean absorbance for each study grouped by frequency. If multiple measurements exist for the same ear, average those first before aggregating across subjects.</p></li>
<li><p>Use the <code>COUNT(DISTINCT SubjectNumber, Ear)</code> SQL query to compute the number of unique ears for each study.</p></li>
<li><p>Build the labels (e.g., “Abur et al.&nbsp;(2014) N=14; HearID”) using the <code>GROUP BY Identifier, Instrument</code>.</p></li>
</ul></li>
<li><p><strong>SQL Query</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RMariaDB)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>con_wai <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">MariaDB</span>(), <span class="at">host =</span> <span class="st">"scidb.smith.edu"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">user =</span> <span class="st">"waiuser"</span>, <span class="at">password =</span> <span class="st">"smith_waiDB"</span>, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">dbname =</span> <span class="st">"wai"</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>Measurements <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con_wai, <span class="st">"Measurements"</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>PI_Info <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con_wai, <span class="st">"PI_Info"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>Subjects <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con_wai, <span class="st">"Subjects"</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># collect(Measurements)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">TABLES</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>7 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Tables_in_wai</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Codebook</td>
</tr>
<tr class="even">
<td style="text-align: left;">Measurements</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Measurements_pre2020</td>
</tr>
<tr class="even">
<td style="text-align: left;">PI_Info</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PI_Info_OLD</td>
</tr>
<tr class="even">
<td style="text-align: left;">Subjects</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Subjects_pre2020</td>
</tr>
</tbody>
</table>
</div>
</div></li>
</ol>
</section>
</section>
<section id="step-2-recreate-figure-1" class="level3">
<h3 class="anchored" data-anchor-id="step-2-recreate-figure-1"><strong>Step 2: Recreate Figure 1</strong></h3>
<p>The goal is to calculate mean absorbance for the 12 studies, grouped by frequency, and create a plot that resembles the figure provided.</p>
<section id="sql-query" class="level4">
<h4 class="anchored" data-anchor-id="sql-query">SQL Query</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">Identifier</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    Instrument,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> <span class="fu">CONCAT</span>(SubjectNumber, Ear)) <span class="kw">AS</span> Unique_Ears, <span class="co">-- Count unique ears</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    Frequency,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">AVG</span>(Absorbance) <span class="kw">AS</span> Mean_Absorbance</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Measurements</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> <span class="kw">Identifier</span> <span class="kw">IN</span> (<span class="st">'Abur_2014'</span>, <span class="st">'Feeney_2017'</span>, <span class="st">'Groon_2015'</span>, </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Lewis_2015'</span>, <span class="st">'Liu_2008'</span>, <span class="st">'Rosowski_2012'</span>, </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Shahnaz_2006'</span>, <span class="st">'Shaver_2013'</span>, <span class="st">'Sun_2016'</span>, </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Voss_1994'</span>, <span class="st">'Voss_2010'</span>, <span class="st">'Werner_2010'</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">Identifier</span>, Instrument, Frequency</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Frequency;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Identifier</th>
<th style="text-align: left;">Instrument</th>
<th style="text-align: right;">Unique_Ears</th>
<th style="text-align: right;">Frequency</th>
<th style="text-align: right;">Mean_Absorbance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Lewis_2015</td>
<td style="text-align: left;">Other</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0.00000</td>
<td style="text-align: right;">0.9999481</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lewis_2015</td>
<td style="text-align: left;">Other</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">5.85938</td>
<td style="text-align: right;">0.9999481</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lewis_2015</td>
<td style="text-align: left;">Other</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">11.71880</td>
<td style="text-align: right;">0.9999481</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lewis_2015</td>
<td style="text-align: left;">Other</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">17.57810</td>
<td style="text-align: right;">0.0942423</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lewis_2015</td>
<td style="text-align: left;">Other</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">23.43750</td>
<td style="text-align: right;">0.0955518</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lewis_2015</td>
<td style="text-align: left;">Other</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">29.29690</td>
<td style="text-align: right;">0.0972262</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lewis_2015</td>
<td style="text-align: left;">Other</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">35.15620</td>
<td style="text-align: right;">0.0992588</td>
</tr>
<tr class="even">
<td style="text-align: left;">Voss_1994</td>
<td style="text-align: left;">preHearID</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">39.06250</td>
<td style="text-align: right;">-0.0280960</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lewis_2015</td>
<td style="text-align: left;">Other</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">41.01560</td>
<td style="text-align: right;">0.1016413</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lewis_2015</td>
<td style="text-align: left;">Other</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">46.87500</td>
<td style="text-align: right;">0.1043644</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Loading Data into R:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>query_figure1 <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT </span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">    m.Identifier,</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="st">    m.Instrument,</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">    COUNT(DISTINCT CONCAT(m.SubjectNumber, m.Ear)) AS Unique_Ears, -- Count unique ears</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">    m.Frequency,</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="st">    AVG(m.Absorbance) AS Mean_Absorbance</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">FROM Measurements m</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE m.Identifier IN ('Abur_2014', 'Feeney_2017', 'Groon_2015', </span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="st">                        'Lewis_2015', 'Liu_2008', 'Rosowski_2012', </span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="st">                        'Shahnaz_2006', 'Shaver_2013', 'Sun_2016', </span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="st">                        'Voss_1994', 'Voss_2010', 'Werner_2010')</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="st">  AND m.Frequency &gt; 200 -- Filter relevant frequencies</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="st">  AND m.Frequency &lt; 8000 -- Align with the x-axis scale</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY m.Identifier, m.Instrument, m.Frequency</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY m.Identifier, m.Frequency;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Plotting the Data:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Query for Figure 1</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>data_figure1 <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con_wai, query_figure1)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_figure1, <span class="fu">aes</span>(<span class="at">x =</span> Frequency, <span class="at">y =</span> Mean_Absorbance, <span class="at">color =</span> Identifier)) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span>  <span class="co"># Log scale for frequency</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Mean Absorbance from Each Publication in WAI Database"</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Frequency (Hz)"</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Mean Absorbance"</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mini-project-4_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Alt Text for the Plot:</strong></p>
<p>A line plot showing the mean absorbance values across different frequencies (in Hz) for various publications in the WAI database. The x-axis represents the frequency ranging from approximately 100 Hz to 4000 Hz, and the y-axis represents the mean absorbance values, ranging from 0 to 0.8. Each line corresponds to a different publication, identified by the legend on the right, with distinct colors representing each study. The plot shows variations in absorbance curves among the publications, with some exhibiting peaks and troughs at different frequencies.</p>
</section>
</section>
<section id="description-of-the-plot" class="level3">
<h3 class="anchored" data-anchor-id="description-of-the-plot"><strong>Description of the Plot</strong></h3>
<p>This plot visualizes the <strong>mean absorbance</strong> across frequencies for 12 studies from the <strong>Wideband Acoustic Immittance (WAI) Database</strong>. Each line represents a unique study, identified in the legend by the <strong>author name</strong>, <strong>year</strong>, and instrument type. Here’s a breakdown of its components:</p>
<ol type="1">
<li><p><strong>X-Axis (Frequency)</strong>:</p>
<ul>
<li><p>Represents the frequency range, plotted on a logarithmic scale from approximately <strong>200 Hz to 8000 Hz</strong>.</p></li>
<li><p>This scale allows for better visualization of frequency-dependent trends over a wide range of values.</p></li>
</ul></li>
<li><p><strong>Y-Axis (Mean Absorbance)</strong>:</p>
<ul>
<li><p>Represents the mean absorbance values, ranging from <strong>0.1 to 0.8</strong>.</p></li>
<li><p>Absorbance is a measure of how much sound energy is absorbed by the ear canal and middle ear system, averaged across all subjects and measurements for a given frequency in each study.</p></li>
</ul></li>
<li><p><strong>Legend</strong>:</p>
<ul>
<li><p>Each study is uniquely identified in the legend by the <strong>author (shortened)</strong>, <strong>publication year</strong>, and the instrument used for data collection.</p></li>
<li><p>Example: “Feeney_2017” corresponds to a study by Feeney published in 2017.</p></li>
</ul></li>
<li><p><strong>Observations</strong>:</p>
<ul>
<li><p>The curves generally rise sharply from low frequencies (~200 Hz), peak around the mid-range frequencies (1000–3000 Hz), and then decline at higher frequencies.</p></li>
<li><p>Some studies (e.g., <code>Groon_2015</code> and <code>Werner_2010</code>) exhibit smoother curves, while others show variations or dips, indicating potential differences in instrumentation, measurement techniques, or subject demographics.</p></li>
</ul></li>
<li><p><strong>Purpose</strong>:</p>
<ul>
<li>The plot provides a comparative overview of mean absorbance trends across studies, highlighting the similarities and differences in ear acoustic properties measured under different experimental setups.</li>
</ul></li>
</ol>
</section>
<section id="conclusion-summary-of-the-analysis" class="level3">
<h3 class="anchored" data-anchor-id="conclusion-summary-of-the-analysis"><strong>Conclusion &amp; Summary of the Analysis</strong></h3>
<p>The goal of this project was to analyze the <strong>Wideband Acoustic Immittance (WAI)</strong> database to recreate <strong>Figure 1</strong> from the Voss (2020) paper and conduct a group-based analysis of absorbance data (e.g., by age categories). Here’s a step-by-step breakdown of what we accomplished:</p>
<hr>
<section id="setting-up-the-database-connection" class="level4">
<h4 class="anchored" data-anchor-id="setting-up-the-database-connection"><strong>1. Setting Up the Database Connection</strong></h4>
<ul>
<li><p>Connected to the WAI database hosted at Smith College using the <code>RMariaDB</code> package in R.</p></li>
<li><p>Retrieved data from three primary tables: <code>Measurements</code>, <code>Subjects</code>, and <code>PI_Info</code>.</p></li>
<li><p>Validated the connection by exploring the database schema (e.g., using <code>SHOW TABLES</code> and <code>DESCRIBE</code> commands).</p></li>
</ul>
<hr>
</section>
<section id="recreating-figure-1" class="level4">
<h4 class="anchored" data-anchor-id="recreating-figure-1"><strong>2. Recreating Figure 1</strong></h4>
<ul>
<li><p><strong>Key Insights from Figure 1’s Caption</strong>:</p>
<ul>
<li><p>Mean absorbance for each study was calculated across all ears, considering both left and right ear measurements.</p></li>
<li><p>Studies were grouped by <code>Identifier</code> and <code>Instrument</code>, and unique ears were counted for each study.</p></li>
</ul></li>
<li><p><strong>SQL Query for Data Retrieval</strong>:</p>
<ul>
<li><p>Filtered for the 12 specific studies mentioned in Figure 1.</p></li>
<li><p>Restricted frequencies to the range [200 Hz, 8000 Hz] to match the original plot.</p></li>
<li><p>Averaged absorbance measurements for each frequency after combining left and right ears.</p></li>
<li><p>Counted unique ears using <code>COUNT(DISTINCT CONCAT(SubjectNumber, Ear))</code>.</p></li>
</ul></li>
<li><p><strong>Plotting</strong>:</p>
<ul>
<li><p>Used <code>ggplot2</code> to recreate the log-scaled x-axis and show mean absorbance curves for each study.</p></li>
<li><p>Customized the legend to include study details (e.g., year, instrument type).</p></li>
</ul></li>
</ul>
<hr>
</section>
<section id="group-based-analysis-age-categories" class="level4">
<h4 class="anchored" data-anchor-id="group-based-analysis-age-categories"><strong>3. Group-Based Analysis (Age Categories)</strong></h4>
<ul>
<li><p><strong>Objective</strong>:</p>
<ul>
<li>Analyze how absorbance changes across frequencies for different age groups (e.g., Adult, Child, Infant).</li>
</ul></li>
<li><p><strong>SQL Query</strong>:</p>
<ul>
<li><p>Joined <code>Measurements</code> and <code>Subjects</code> tables to link frequency/absorbance data with demographic data.</p></li>
<li><p>Grouped data by <code>AgeCategoryFirstMeasurement</code> and <code>Frequency</code>.</p></li>
<li><p>Filtered out <code>NULL</code> values in age categories.</p></li>
</ul></li>
<li><p><strong>Plotting</strong>:</p>
<ul>
<li><p>Visualized mean absorbance for each frequency, with separate lines for each age category.</p></li>
<li><p>Used a log-scale for the x-axis (frequency) and restricted the y-axis to valid absorbance ranges.</p></li>
</ul></li>
</ul>
<hr>
</section>
</section>
</section>
<section id="part-2" class="level2">
<h2 class="anchored" data-anchor-id="part-2">Part 2</h2>
<section id="plan-1" class="level4">
<h4 class="anchored" data-anchor-id="plan-1"><strong>Plan:</strong></h4>
</section>
<section id="the-goal-was-to-analyze-how-mean-absorbance-varies-across-frequencies-for-different-sex-groups-male-and-female-across-multiple-studies.-heres-the-step-by-step-plan" class="level3">
<h3 class="anchored" data-anchor-id="the-goal-was-to-analyze-how-mean-absorbance-varies-across-frequencies-for-different-sex-groups-male-and-female-across-multiple-studies.-heres-the-step-by-step-plan">The goal was to analyze how mean absorbance varies across frequencies for different sex groups (<code>Male</code> and <code>Female</code>) across multiple studies. Here’s the step-by-step plan:</h3>
<ol type="1">
<li><p><strong>Identify Diverse Studies</strong>:</p>
<ul>
<li><p>Query the <code>Subjects</code> table to find studies (<code>Identifiers</code>) that included at least two distinct sex groups (<code>Male</code> and <code>Female</code>) while excluding those dominated by <code>Unknown</code>.</p></li>
<li><p>Ensure the selected studies had sufficient valid data (i.e., meaningful counts for <code>Male</code> and <code>Female</code> groups).</p></li>
</ul></li>
<li><p><strong>Filter and Aggregate Data</strong>:</p>
<ul>
<li><p>Using SQL, filter the <code>Measurements</code> and <code>Subjects</code> tables for the selected studies.</p></li>
<li><p>Exclude <code>Unknown</code> values for <code>Sex</code>, restrict frequencies to a meaningful range (200 Hz to 8000 Hz), and ensure absorbance values were valid.</p></li>
<li><p>Calculate the mean absorbance for each frequency within each sex group (<code>Male</code> or <code>Female</code>) for each study.</p></li>
</ul></li>
<li><p><strong>Fetch the Data into R</strong>:</p>
<ul>
<li><p>Execute the SQL query in R to retrieve the aggregated data.</p></li>
<li><p>Preview the data to ensure it included the required fields: <code>Identifier</code>, <code>GroupName</code> (Sex), <code>Frequency</code>, and <code>Mean_Absorbance</code>.</p></li>
</ul></li>
<li><p><strong>Visualize the Results</strong>:</p>
<ul>
<li><p>Use <code>ggplot2</code> to create a log-scaled plot of mean absorbance against frequency for <code>Male</code> and <code>Female</code> groups.</p></li>
<li><p>Separate the data by study (<code>Identifier</code>) using facets to allow comparison of trends across multiple studies.</p></li>
</ul></li>
<li><p><strong>Dynamic Extension</strong>:</p>
<ul>
<li>Ensure the workflow could dynamically include additional studies by simply updating the list of <code>Identifiers</code> in the SQL query.</li>
</ul></li>
</ol>
</section>
<section id="step-1-inspect-the-data" class="level3">
<h3 class="anchored" data-anchor-id="step-1-inspect-the-data"><strong>Step 1:</strong> Inspect the Data</h3>
<p>We’ll query the <code>Subjects</code> table to find studies (<code>Identifier</code>) that include multiple <code>Sex</code> groups (e.g., <code>Male</code> and <code>Female</code>) and exclude those dominated by <code>Unknown</code>.</p>
<section id="sql-query-to-inspect-distribution" class="level4">
<h4 class="anchored" data-anchor-id="sql-query-to-inspect-distribution">SQL Query to Inspect Distribution:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">Identifier</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> Total_Subjects,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> Sex) <span class="kw">AS</span> Sex_Groups,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(<span class="cf">CASE</span> <span class="cf">WHEN</span> Sex <span class="op">=</span> <span class="st">'Unknown'</span> <span class="cf">THEN</span> <span class="dv">1</span> <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span>) <span class="kw">AS</span> Unknown_Count</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Subjects</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">Identifier</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="kw">HAVING</span> Sex_Groups <span class="op">&gt;</span> <span class="dv">1</span> <span class="kw">AND</span> (Total_Subjects <span class="op">-</span> Unknown_Count) <span class="op">&gt;</span> <span class="dv">0</span>; <span class="co">-- Ensure diversity</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Identifier</th>
<th style="text-align: right;">Total_Subjects</th>
<th style="text-align: right;">Sex_Groups</th>
<th style="text-align: right;">Unknown_Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Aithal_2013</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Aithal_2014</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Aithal_2014b</td>
<td style="text-align: right;">184</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Aithal_2015</td>
<td style="text-align: right;">141</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Aithal_2017a</td>
<td style="text-align: right;">203</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Aithal_2017b</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Aithal_2019a</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Aithal_2019b</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Aithal_2020a</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Aithal_2020b</td>
<td style="text-align: right;">109</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SQL query to find identifiers with diverse Sex groups</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>query_diverse_studies <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT </span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="st">    Identifier,</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="st">    COUNT(*) AS Total_Subjects,</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="st">    COUNT(DISTINCT Sex) AS Sex_Groups,</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="st">    SUM(CASE WHEN Sex = 'Unknown' THEN 1 ELSE 0 END) AS Unknown_Count</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="st">FROM Subjects</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY Identifier</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="st">HAVING Sex_Groups &gt; 1 AND (Total_Subjects - Unknown_Count) &gt; 0;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute the query</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>diverse_studies <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con_wai, query_diverse_studies)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the diverse studies</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(diverse_studies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Identifier Total_Subjects Sex_Groups Unknown_Count
1     Aithal_2013             66          2             0
2     Aithal_2014             96          2             0
3    Aithal_2014b            184          2             0
4     Aithal_2015            141          2             0
5    Aithal_2017a            203          2             0
6    Aithal_2017b             58          2             0
7    Aithal_2019a            111          2             0
8    Aithal_2019b             99          2             0
9    Aithal_2020a             71          2             0
10   Aithal_2020b            109          2             0
11    Aithal_2022            249          2             0
12 AlMakadma_2021             50          2             0
13   Downing_2022            924          2             0
14   Ellison_2012             88          2             0
15     Groon_2015             21          3             1
16    Hunter_2016            182          2             0
17     Keefe_2012             55          2             0
18     Keefe_2017             33          2             0
19     Lewis_2015             14          2             0
20     Lewis_2018             30          3             2
21       Liu_2008             48          2             0
22  Merchant_2010             17          2             0
23  Merchant_2015             32          2             0
24  Merchant_2020             29          2             0
25  Merchant_2021             35          2             0
26     Myers_2018            543          2             0
27  Nakajima_2012             30          2             0
28    Pitaro_2016            154          2             0
29  Rosowski_2012             29          2             0
30   Sanford_2009            230          2             0
31   Sanford_2014             29          2             0
32   Shahnaz_2006            126          2             0
33    Shaver_2013             48          2             0
34     Sliwa_2020            148          3             0
35       Sun_2016             84          2             0
36       Sun_2023           3582          2             0
37      Voss_1994             10          2             0
38      Voss_2010             12          2             0
39      Voss_2016             27          2             0
40    Werner_2010            666          2             0</code></pre>
</div>
</div>
</section>
</section>
<section id="step-2-aggregate-absorbance-for-multiple-studies" class="level3">
<h3 class="anchored" data-anchor-id="step-2-aggregate-absorbance-for-multiple-studies"><strong>Step 2: Aggregate Absorbance for Multiple Studies</strong></h3>
<p>Now that we have a list of diverse studies, let’s calculate mean absorbance across frequencies for all of them.</p>
<section id="sql-query-1" class="level4">
<h4 class="anchored" data-anchor-id="sql-query-1">SQL Query:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    m.<span class="kw">Identifier</span>,        <span class="co">-- Include study identifier</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    s.Sex <span class="kw">AS</span> GroupName,  <span class="co">-- Group by Sex</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    m.Frequency,         <span class="co">-- Frequency in Hz</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">AVG</span>(m.Absorbance) <span class="kw">AS</span> Mean_Absorbance <span class="co">-- Average absorbance</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Measurements m</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> Subjects s </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ON</span> m.SubjectNumber <span class="op">=</span> s.SubjectNumber</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> m.<span class="kw">Identifier</span> <span class="op">=</span> s.<span class="kw">Identifier</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> m.<span class="kw">Identifier</span> <span class="kw">IN</span> (<span class="st">'Abur_2014'</span>, <span class="st">'Feeney_2017'</span>, <span class="st">'Groon_2015'</span>, </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'Lewis_2015'</span>, <span class="st">'Liu_2008'</span>, <span class="st">'Rosowski_2012'</span>, </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'Shahnaz_2006'</span>, <span class="st">'Shaver_2013'</span>, <span class="st">'Sun_2016'</span>, </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'Voss_1994'</span>, <span class="st">'Voss_2010'</span>, <span class="st">'Werner_2010'</span>) </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">AND</span> m.Frequency <span class="op">&gt;</span> <span class="dv">200</span>            <span class="co">-- Restrict frequencies to valid range</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">AND</span> m.Frequency <span class="op">&lt;</span> <span class="dv">8000</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">AND</span> m.Absorbance <span class="op">&gt;=</span> <span class="dv">0</span>            <span class="co">-- Exclude invalid absorbance values</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">AND</span> s.Sex <span class="kw">IN</span> (<span class="st">'Male'</span>, <span class="st">'Female'</span>)  <span class="co">-- Exclude Unknown values</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> m.<span class="kw">Identifier</span>, s.Sex, m.Frequency <span class="co">-- Group by Identifier, Sex, and Frequency</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> m.<span class="kw">Identifier</span>, s.Sex, m.Frequency;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Identifier</th>
<th style="text-align: left;">GroupName</th>
<th style="text-align: right;">Frequency</th>
<th style="text-align: right;">Mean_Absorbance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Abur_2014</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">210.938</td>
<td style="text-align: right;">0.0784746</td>
</tr>
<tr class="even">
<td style="text-align: left;">Abur_2014</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">234.375</td>
<td style="text-align: right;">0.0826420</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Abur_2014</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">257.812</td>
<td style="text-align: right;">0.0948482</td>
</tr>
<tr class="even">
<td style="text-align: left;">Abur_2014</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">281.250</td>
<td style="text-align: right;">0.1031472</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Abur_2014</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">304.688</td>
<td style="text-align: right;">0.1137576</td>
</tr>
<tr class="even">
<td style="text-align: left;">Abur_2014</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">328.125</td>
<td style="text-align: right;">0.1221205</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Abur_2014</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">351.562</td>
<td style="text-align: right;">0.1334329</td>
</tr>
<tr class="even">
<td style="text-align: left;">Abur_2014</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">375.000</td>
<td style="text-align: right;">0.1447725</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Abur_2014</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">398.438</td>
<td style="text-align: right;">0.1563874</td>
</tr>
<tr class="even">
<td style="text-align: left;">Abur_2014</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">421.875</td>
<td style="text-align: right;">0.1806973</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="step-3-fetch-data-in-r" class="level3">
<h3 class="anchored" data-anchor-id="step-3-fetch-data-in-r"><strong>Step 3: Fetch Data in R</strong></h3>
<p>Run the query and fetch the results into R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SQL query for multiple identifiers</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>query_sex_absorption_multiple <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT </span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="st">    m.Identifier,</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="st">    s.Sex AS GroupName,</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="st">    m.Frequency,</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="st">    AVG(m.Absorbance) AS Mean_Absorbance</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="st">FROM Measurements m</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN Subjects s </span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="st">    ON m.SubjectNumber = s.SubjectNumber</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="st">    AND m.Identifier = s.Identifier</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE m.Identifier IN ('Abur_2014', 'Feeney_2017', 'Groon_2015', </span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="st">                        'Lewis_2015', 'Liu_2008', 'Rosowski_2012', </span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="st">                        'Shahnaz_2006', 'Shaver_2013', 'Sun_2016', </span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="st">                        'Voss_1994', 'Voss_2010', 'Werner_2010') </span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="st">  AND m.Frequency &gt; 200</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="st">  AND m.Frequency &lt; 8000</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="st">  AND m.Absorbance &gt;= 0</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="st">  AND s.Sex IN ('Male', 'Female')</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY m.Identifier, s.Sex, m.Frequency</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY m.Identifier, s.Sex, m.Frequency;</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch results</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>data_sex_absorption_multiple <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con_wai, query_sex_absorption_multiple)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the data</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_sex_absorption_multiple)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Identifier GroupName Frequency Mean_Absorbance
1  Abur_2014    Female   210.938      0.07847459
2  Abur_2014    Female   234.375      0.08264199
3  Abur_2014    Female   257.812      0.09484823
4  Abur_2014    Female   281.250      0.10314722
5  Abur_2014    Female   304.688      0.11375764
6  Abur_2014    Female   328.125      0.12212053</code></pre>
</div>
</div>
</section>
<section id="step-4-plot-the-data" class="level3">
<h3 class="anchored" data-anchor-id="step-4-plot-the-data"><strong>Step 4: Plot the Data</strong></h3>
<p>Visualize the absorbance trends for multiple studies:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_sex_absorption_multiple, <span class="fu">aes</span>(<span class="at">x =</span> Frequency, <span class="at">y =</span> Mean_Absorbance, <span class="at">color =</span> GroupName)) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Identifier) <span class="sc">+</span>  <span class="co"># Create separate plots for each study</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span>           <span class="co"># Log scale for frequency</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Mean Absorbance by Sex Across Multiple Studies"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Frequency (Hz)"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Mean Absorbance"</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Sex"</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mini-project-4_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Alt Text for the Plot:</strong></p>
<p>A grid of line plots comparing mean absorbance values by sex across multiple studies. Each subplot represents a study, with the x-axis showing frequency in Hz (ranging from 300 to 3000 Hz) and the y-axis showing mean absorbance values (ranging from 0 to 0.8). The lines are color-coded by sex: red for female, green for male in some studies, and blue for male in others. The legend on the right associates the colors with sex categories. Differences in absorbance trends between males and females are visible, with variations across the individual studies such as ‘Abur_2014,’ ‘Voss_1994,’ and ’Werner_2010.</p>
</section>
<section id="description-of-the-plot-1" class="level3">
<h3 class="anchored" data-anchor-id="description-of-the-plot-1"><strong>Description of the Plot</strong></h3>
<p>This plot visualizes the <strong>mean absorbance</strong> across frequencies for <strong>Male</strong> and <strong>Female</strong> participants across multiple studies from the <strong>Wideband Acoustic Immittance (WAI) Database</strong>. The studies are displayed as individual facets, allowing for a comparative analysis of trends by sex within each study. Here’s a detailed breakdown:</p>
<hr>
<ol type="1">
<li><p><strong>Faceted Layout (Studies)</strong>:</p>
<ul>
<li><p>Each facet represents a study identified by the <strong>author name</strong> and <strong>publication year</strong> (e.g., <code>Abur_2014</code>, <code>Groon_2015</code>).</p></li>
<li><p>This layout enables a side-by-side comparison of sex-based trends across different studies.</p></li>
</ul></li>
<li><p><strong>X-Axis (Frequency)</strong>:</p>
<ul>
<li>Frequency is plotted on a logarithmic scale (300 Hz to 8000 Hz), emphasizing differences across a wide range of frequencies.</li>
</ul></li>
<li><p><strong>Y-Axis (Mean Absorbance)</strong>:</p>
<ul>
<li><p>Mean absorbance values range from <strong>0.0 to 0.8</strong>.</p></li>
<li><p>Absorbance represents the proportion of sound energy absorbed by the ear canal and middle ear system.</p></li>
</ul></li>
<li><p><strong>Color-Coded Lines</strong>:</p>
<ul>
<li><p><strong>Red</strong>: Absorbance trends for <code>Female</code> participants.</p></li>
<li><p><strong>Blue<code>or</code>Green</strong>: Absorbance trends for <code>Male</code> participants.</p></li>
<li><p>The colors indicate how absorbance varies between sexes across different frequencies within each study.</p></li>
</ul></li>
<li><p><strong>Key Observations</strong>:</p>
<ul>
<li><p><strong>General Trends</strong>:</p>
<ul>
<li>Across most studies, the absorbance rises sharply at low frequencies, peaks in the mid-range (around 1000–3000 Hz), and gradually declines at higher frequencies.</li>
</ul></li>
<li><p><strong>Sex Differences</strong>:</p>
<ul>
<li><p>Many studies show overlapping trends between <code>Male</code> and <code>Female</code>, but some (e.g., <code>Lewis_2015</code>, <code>Shaver_2013</code>) show slight differences in mid-to-high frequency ranges.</p></li>
<li><p>For some studies (e.g., <code>Liu_2008</code>, <code>Shahnaz_2006</code>), <code>Female</code> participants exhibit slightly higher absorbance at certain frequencies, whereas others show the reverse pattern.</p></li>
</ul></li>
<li><p><strong>Variability Across Studies</strong>:</p>
<ul>
<li>Certain studies (e.g., <code>Shaver_2013</code>, <code>Groon_2015</code>) exhibit more pronounced differences between sexes compared to others (e.g., <code>Abur_2014</code>, <code>Werner_2010</code>).</li>
</ul></li>
</ul></li>
<li><p><strong>Purpose</strong>:</p>
<ul>
<li>The plot aims to highlight how <strong>sex</strong> influences mean absorbance trends across different studies and frequencies, revealing potential patterns and variability in auditory measurements.</li>
</ul></li>
</ol>
</section>
<section id="summary-conclusion" class="level3">
<h3 class="anchored" data-anchor-id="summary-conclusion"><strong>Summary Conclusion</strong></h3>
<p>The analysis successfully identified multiple studies with sufficient diversity in sex groups and calculated mean absorbance values across frequencies for <code>Male</code> and <code>Female</code> participants. The SQL-centric approach ensured that all filtering, grouping, and aggregation were performed efficiently within the database, minimizing processing in R.</p>
<p>The visualization provided insights into absorbance trends by sex for each study, showing distinct patterns in absorbance levels across different frequencies. This approach is scalable to include additional studies or alternative demographic groups (e.g., Race or Ethnicity), making it flexible for broader analyses.</p>
<hr>
</section>
<section id="sources-of-the-data" class="level3">
<h3 class="anchored" data-anchor-id="sources-of-the-data"><strong>Sources of the Data</strong></h3>
<ol type="1">
<li><p><strong>Wideband Acoustic Immittance (WAI) Database</strong>:</p>
<ul>
<li><p>The data used in this project is sourced from the <strong>WAI Database</strong> hosted by Smith College.</p></li>
<li><p>The database contains wideband acoustic immittance measurements from peer-reviewed publications, covering various studies aimed at noninvasive auditory diagnostics for people of all ages.</p></li>
</ul></li>
<li><p><strong>Specific Studies Included in the Analysis</strong>:</p>
<ul>
<li><p>The following studies, as cited in the database, were included in the analysis:</p>
<ul>
<li><p><strong>Abur et al.&nbsp;(2014)</strong>: HearID</p></li>
<li><p><strong>Feeney et al.&nbsp;(2017)</strong>: Not commercial system</p></li>
<li><p><strong>Groon et al.&nbsp;(2015)</strong>: Not commercial system</p></li>
<li><p><strong>Lewis and Neely (2015)</strong>: Not commercial system</p></li>
<li><p><strong>Liu et al.&nbsp;(2008)</strong>: Not commercial system</p></li>
<li><p><strong>Rosowski et al.&nbsp;(2012)</strong>: HearID</p></li>
<li><p><strong>Shahnaz et al.&nbsp;(2006)</strong>: HearID</p></li>
<li><p><strong>Shaver and Sun (2013)</strong>: Titan</p></li>
<li><p><strong>Sun et al.&nbsp;(2016)</strong>: Titan</p></li>
<li><p><strong>Voss and Allen (1994)</strong>: Not commercial system</p></li>
<li><p><strong>Voss et al.&nbsp;(2010)</strong>: HearID</p></li>
<li><p><strong>Werner et al.&nbsp;(2010)</strong>: Not commercial system</p></li>
</ul></li>
</ul></li>
<li><p><strong>Data Access</strong>:</p>
<ul>
<li>The database was accessed through the MySQL connection to the <strong>Smith College WAI database server</strong> using credentials provided for research purposes. All filtering, grouping, and aggregation operations were performed on the database directly.</li>
</ul></li>
</ol>
</section>
<section id="citation" class="level3">
<h3 class="anchored" data-anchor-id="citation"><strong>Citation</strong></h3>
<p>Smith College WAI Database. (2024). <em>Wideband Acoustic Immittance (WAI) Database</em> [Database]. Smith College. Retrieved from the Smith College WAI Database server for research purposes.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>